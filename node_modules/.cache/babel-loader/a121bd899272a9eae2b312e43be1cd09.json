{"ast":null,"code":"import axios from \"axios\";\nimport { API, API_BASE_URL } from './config';\n// LocalstorageService\n// Add a request interceptor\nconst client = axios;\nclient.defaults.baseURL = API;\nclient.interceptors.request.use(config => {\n  const basicAuth = Buffer.from(\"FE_WEB\" + \":\" + \"secret\").toString('base64');\n  const token = JSON.parse(localStorage.getItem(\"jwt\"));\n  if (token) {\n    if (config.url === \"https://local-partner-node-service.vercel.app/oauth/token\") {\n      config.headers[\"Authorization\"] = \"Basic \" + basicAuth;\n    } else {\n      config.headers[\"Authorization\"] = \"Bearer \" + token;\n    }\n  }\n  return config;\n}, error => {\n  Promise.reject(error);\n});\n//Add a response interceptor\nclient.interceptors.response.use(response => {\n  return response;\n}, function (error) {\n  const originalRequest = error.config;\n  console.log(error);\n  if (error.status === 401 && originalRequest.url === `${API_BASE_URL}/oauth/token`) {\n    return Promise.reject(error);\n  }\n  if (error.response.status === 401 && !originalRequest._retry) {\n    originalRequest._retry = true;\n    const refreshToken = localStorage.getItem(\"refreshToken\");\n    const basicAuth = Buffer.from(\"FE_WEB\" + \":\" + \"secret\").toString('base64');\n    const payload = new URLSearchParams({\n      'refresh_token': refreshToken,\n      'grant_type': 'refresh_token'\n    });\n    return axios.post(`${API_BASE_URL}/oauth/token`, payload, {\n      headers: {\n        Accept: 'application/x-www-form-urlencoded',\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Authorization': 'Basic ' + basicAuth\n      }\n    }).then(res => {\n      console.log(\"hello from the client\", res.data.accessToken);\n      const refreshToken = res.data.refreshToken;\n      const token = JSON.stringify(res.data.accessToken);\n      console.log(token);\n      localStorage.setItem(\"refreshToken\", refreshToken);\n      localStorage.setItem(\"jwt\", token);\n      return axios(originalRequest);\n    });\n  }\n  return Promise.reject(error);\n});\nexport default client;","map":{"version":3,"names":["axios","API","API_BASE_URL","client","defaults","baseURL","interceptors","request","use","config","basicAuth","Buffer","from","toString","token","JSON","parse","localStorage","getItem","url","headers","error","Promise","reject","response","originalRequest","console","log","status","_retry","refreshToken","payload","URLSearchParams","post","Accept","then","res","data","accessToken","stringify","setItem"],"sources":["C:/localpartner-Repo/LocalPartner-AdminPanel/src/Client.js"],"sourcesContent":["import axios from \"axios\";\nimport { API, API_BASE_URL } from './config';\n// LocalstorageService\n// Add a request interceptor\nconst client = axios;\nclient.defaults.baseURL= API;\nclient.interceptors.request.use(\n  (config) => {\n    const basicAuth = Buffer.from(\"FE_WEB\" + \":\" + \"secret\").toString('base64');\n    const token = JSON.parse(localStorage.getItem(\"jwt\"));\n    if (token) {\n     \n      if(config.url===\"https://local-partner-node-service.vercel.app/oauth/token\"){\n        config.headers[\"Authorization\"] = \"Basic \" + basicAuth;\n      }\n      \n      else{\n        config.headers[\"Authorization\"] = \"Bearer \" + token;\n    }\n  }\n     \n    return config;\n  },\n  (error) => {\n    Promise.reject(error);\n  }\n);\n//Add a response interceptor\nclient.interceptors.response.use(\n  (response) => {\n\n    return response;\n    \n  },\nfunction (error) {\n    const originalRequest = error.config;\n    console.log(error)\n    if (\n      error.status === 401 &&\n      originalRequest.url === `${API_BASE_URL}/oauth/token`\n\n    ) {\n      return Promise.reject(error);\n    }\n    if (error.response.status === 401 && !originalRequest._retry) {\n      originalRequest._retry = true;\n      const refreshToken = localStorage.getItem(\"refreshToken\");\n      const basicAuth = Buffer.from(\"FE_WEB\" + \":\" + \"secret\").toString('base64');\n      const payload=new URLSearchParams({\n        'refresh_token': refreshToken,\n       'grant_type': 'refresh_token'\n        \n    })\n      \n      return axios\n              .post(`${API_BASE_URL}/oauth/token`, payload,{\n                headers: { \n                    Accept: 'application/x-www-form-urlencoded',\n                  'Content-Type': 'application/x-www-form-urlencoded',\n                  'Authorization': 'Basic ' + basicAuth,\n                }})\n              .then((res) => {\n                console.log(\"hello from the client\", res.data.accessToken);\n                \n                  const refreshToken =res.data.refreshToken\n                  const token = JSON.stringify(res.data.accessToken);\n                  console.log(token)\n                  localStorage.setItem(\"refreshToken\", refreshToken);\n                  localStorage.setItem(\"jwt\", token);\n                  return axios(originalRequest);\n            \n              });\n        \n       \n    }\n    return Promise.reject(error);\n  }\n);\nexport default client;"],"mappings":"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"},"metadata":{},"sourceType":"module"}